generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ApplicationStatus {
  APPLIED
  SCREENING
  INTERVIEW
  OFFER
  REJECTED
  ON_HOLD
  WITHDRAWN
}

enum InterviewStage {
  SCREENING
  TECH
  SYSTEM_DESIGN
  MANAGER
  HR
  OFFER_CALL
  OTHER
}

enum InterviewType {
  PHONE
  VIDEO
  ONSITE
  TASK
}

enum ApplicationSource {
  LINKEDIN
  JUSTJOIN
  NOFLUFF
  COMPANY_SITE
  REFERRAL
  OTHER
}

enum AttachmentKind {
  RESUME
  OTHER
}

enum ApplicationSeniority {
  JUNIOR
  MIDDLE
  SENIOR
  LEAD
  PRINCIPAL
}

enum EmploymentType {
  B2B
  UOP
  CONTRACT
  FREELANCE
}


enum Currency {
  PLN
  EUR
  USD
  GBP
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  sessions Session[]
  keys     Key[]

  companies    Company[]
  attachments  Attachment[]
  applications Application[]
  notes        Note[]
}

model Session {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  expiresAt DateTime
}

model Key {
  id             String   @id
  userId         String
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  hashedPassword String?
  primary        Boolean  @default(false)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model Company {
  id String @id @default(cuid())

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  name     String
  website  String?
  location String?

  applications Application[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, name])
  @@index([userId, name])
}

model Application {
  id String @id @default(cuid())

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  companyId String
  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  role   String
  status ApplicationStatus @default(APPLIED)

  seniority      ApplicationSeniority      @default(MIDDLE)
  employmentType EmploymentType @default(B2B)

  source    ApplicationSource?
  sourceUrl String?

  salaryMin        Int?
  salaryMax        Int?
  currency         Currency @default(EUR)
  compensationNote String?

  appliedAt      DateTime @default(now())
  lastActivityAt DateTime @default(now())
  archived       Boolean  @default(false)

  interviews  Interview[]
  notes       Note[]
  attachments Attachment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId, status, lastActivityAt])
  @@index([companyId])
}

model Interview {
  id String @id @default(cuid())

  applicationId String
  application   Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  stage InterviewStage
  type  InterviewType

  scheduledAt DateTime
  durationMin Int?
  timezone    String?

  interviewer String?
  location    String?
  result      String?

  notes Note[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([applicationId, scheduledAt])
}

model Note {
  id String @id @default(cuid())

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  applicationId String?
  application   Application? @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  interviewId String?
  interview   Interview? @relation(fields: [interviewId], references: [id], onDelete: Cascade)

  text      String
  createdAt DateTime @default(now())

  @@index([applicationId, createdAt])
  @@index([interviewId, createdAt])
}

model Attachment {
  id String @id @default(cuid())

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  applicationId String
  application   Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  kind     AttachmentKind @default(OTHER)
  filename String
  mime     String
  size     Int
  url      String

  createdAt DateTime @default(now())

  @@index([applicationId, createdAt])
}
